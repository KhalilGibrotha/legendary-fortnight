schemaVersion: 2.2.0
metadata:
  name: python-env-builder
components:
  - name: python-builder
    container:
      image: registry.access.redhat.com/ubi8/python-39
      memoryLimit: 8Gi
      mountSources: true
commands:
  - id: full-environment-build
    exec:
      component: python-builder
      workingDir: /projects
      commandLine: |
        echo "ðŸš€ Starting Build Process..."
        
        # 1. Setup Micromamba
        if [ ! -f /projects/bin/micromamba ]; then
          mkdir -p /projects/bin
          curl -Ls https://micro.mamba.pm/api/micromamba/linux-64/latest | tar -xj -C /projects/bin --strip-components=1 bin/micromamba
        fi
        
        # 2. Add to PATH for this session
        export PATH=$PATH:/projects/bin
        
        # 3. Create Environment
        echo "ðŸ“¦ Creating Conda environment at /projects/rm_env..."
        micromamba create -y -p /projects/rm_env -f /projects/environment.yml
        
        # 4. Install Packager
        echo "ðŸ”§ Installing conda-pack..."
        micromamba run -p /projects/rm_env pip install conda-pack
        
        echo "âœ… DONE! Check /projects/rm_env"
        